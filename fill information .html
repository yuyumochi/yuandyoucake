<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Account - YU & YOU CAKE</title>

  <!-- âœ… Google Sign-In Script -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

  <style>
    body {
      font-family: 'Courier New', monospace;
      background-image: url("./pic/IMG_2163.JPG");
      background-size: cover;
      background-position: center;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      height: 100vh;
      margin: 0;
      padding-left: 200px;
    }

    .login-box {
      background: rgba(255, 255, 255, 0.7);
      padding: 30px;
      border-radius: 40px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.25);
      width: 400px;
      text-align: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
    }

    .login-box h2 {
      margin-bottom: 10px;
      color: #b22222;
      font-size: 19px;
    }

    .login-box form {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .login-box input,
    .login-box button {
      width: 90%;
      padding: 8px;
      margin: 6px 0;
      border-radius: 8px;
      box-sizing: border-box;
      font-family: inherit;
      font-size: 14px;
    }

    .login-box input {
      border: 1px solid #ccc;
      background: rgba(255,255,255,0.8);
    }

    .login-box button {
      background: #b22222;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    .login-box button:hover {
      background: #a00000;
    }

    .login-box a {
      color: #b22222;
      text-decoration: none;
      font-weight: bold;
      font-size: 13px;
    }

    .login-box a:hover {
      text-decoration: underline;
    }

    .g_id_signin {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    p {
      font-size: 13px;
    }
  </style>
</head>
<body>

  <div class="login-box">
    <h2>Create an Account</h2>
    <h2>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</h2>
    <h2>ğŸ°ğŸ¯ğŸ§ˆğŸ¥šğŸ¥›</h2>

    <!-- âœ… Manual Register -->
    <form onsubmit="return checkMember()">
      <input type="text" id="name" placeholder="Name ç”¨æˆ·å">
      <input type="password" id="password" placeholder="Password å¯†ç ">
      <input type="password" id="confirm" placeholder="Confirm Password ç¡®è®¤å¯†ç ">
      <input type="email" id="email" placeholder="Email ç”µå­é‚®ä»¶">
      <!-- âœ… ç”µè¯æ ï¼šä»…æ™®é€šæ³¨å†Œæ˜¾ç¤º -->
      <input type="text" id="phone" placeholder="Phone Number è”ç»œå·ç ">
      <button type="submit">DONE å®Œæˆ</button>
    </form>

    <p>or</p>

    <!-- âœ… Google Sign-In -->
    <div id="g_id_onload"
         data-client_id="https://docs.google.com/spreadsheets/d/1ev00oQz9fkrs2pV6yLmQbD7YXBYfHJKW0Dx0f3fxCMI/edit?gid=0#gid=0"
         data-context="signup"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>

    <div class="g_id_signin"
         data-type="standard"
         data-shape="rectangular"
         data-theme="outline"
         data-text="signup_with"
         data-size="large"
         data-logo_alignment="left">
    </div>

    <p id="message"></p>

    <a href="./cake website .html">
      -`Click me back to home pages ç‚¹æˆ‘å›ä¸»é¡µÂ´-
    </a>
  </div>

  <script>
    // âœ… è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
    window.onload = function() {
      const loggedUser = JSON.parse(localStorage.getItem("loggedInUser"));
      if (loggedUser) {
        alert(`Welcome back, ${loggedUser.name || loggedUser.username}!`);
        window.location.href = "./cake website .html";
      }
    };

    // âœ… æ‰‹åŠ¨æ³¨å†Œæ£€æŸ¥
    function checkMember() {
      const name = document.getElementById("name").value.trim();
      const pass = document.getElementById("password").value.trim();
      const confirm = document.getElementById("confirm").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const message = document.getElementById("message");

      if (!name || !pass || !confirm || !email || !phone) {
        message.textContent = "Please fill in all fields æœªå®Œæˆå¡«å†™!";
        message.style.color = "red";
        return false;
      }

      if (pass !== confirm) {
        message.textContent = "Passwords do not match èµ„æ–™é”™è¯¯!";
        message.style.color = "red";
        return false;
      }

      let users = JSON.parse(localStorage.getItem("registeredUsers")) || [];

      if (users.find(u => u.username === name)) {
        message.textContent = "Username already exists ç”¨æˆ·åå·²å­˜åœ¨!";
        message.style.color = "red";
        return false;
      }

      const newUser = {
        username: name,
        password: pass,
        name: name,
        email: email,
        phone: phone,
        role: "Member"
      };

      users.push(newUser);
      localStorage.setItem("registeredUsers", JSON.stringify(users));
      localStorage.setItem("loggedInUser", JSON.stringify(newUser));

      message.textContent = "âœ… Account created successfully!";
      message.style.color = "green";

      setTimeout(() => {
        window.location.href = "./cake website .html";
      }, 1500);

      return false;
    }

    // âœ… Google ç™»å½•å›è°ƒ
    function handleCredentialResponse(response) {
      const data = jwt_decode(response.credential);
      console.log("Google user data:", data);

      const newUser = {
        username: data.email,
        name: data.name,
        email: data.email,
        password: "",
        phone: "", // âœ… Gmailç™»å½•ä¸ç”¨ç”µè¯å·ç 
        role: "Member"
      };

      let users = JSON.parse(localStorage.getItem("registeredUsers")) || [];
      const existingUser = users.find(u => u.email === data.email);

      if (!existingUser) {
        users.push(newUser);
        localStorage.setItem("registeredUsers", JSON.stringify(users));
      }

      localStorage.setItem("loggedInUser", JSON.stringify(newUser));

      // âœ… ç™»å½•åéšè—è¾“å…¥æ ï¼ˆä¸ç”¨ç”µè¯ï¼‰
      document.querySelector("form").style.display = "none";

      alert(`Welcome ${data.name}! ğŸ‰ You are now logged in as Member.`);
      window.location.href = "./cake website .html";
    }
  </script>

</body>
</html>
